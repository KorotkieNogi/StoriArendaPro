@model StoriArendaPro.Areas.Admin.Controllers.UserUpdateViewModel
@{
    ViewData["Title"] = "Редактирование пользователя - Ошибки";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Редактирование пользователя - Ошибки валидации</h1>
        <a href="@Url.Action("Users")" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Назад к списку
        </a>
    </div>

    <div class="alert alert-danger">
        <h5><i class="fas fa-exclamation-triangle me-2"></i>Ошибки валидации</h5>
        <ul class="mb-0">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Основная информация</h6>
                </div>
                <div class="card-body">
                    <form method="post" action="@Url.Action("UpdateUser")">
                        <input type="hidden" name="UserId" value="@Model.UserId">

                        <div class="mb-3">
                            <label class="form-label">Полное имя *</label>
                            <input type="text" class="form-control" name="FullName" value="@Model.FullName" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" name="Email" value="@Model.Email" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Телефон *</label>
                            <input type="tel" class="form-control" name="PhoneNumber" value="@Model.PhoneNumber" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Статус</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="IsActive"
                                @(Model.IsActive ? "checked" : "") value="true">
                                <label class="form-check-label">Активный пользователь</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Роли</label>
                            <select class="form-select" name="SelectedRoles" multiple>
                                @foreach (var roleName in ViewBag.AllRoles)
                                {
                                    <option value="@roleName"
                                            selected="@(Model.SelectedRoles != null && Model.SelectedRoles.Contains(roleName) ? "selected" : null)">
                                        @roleName
                                    </option>
                                }
                            </select>
                            <small class="text-muted">Удерживайте Ctrl для выбора нескольких ролей</small>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Сохранить изменения
                        </button>
                        <a href="@Url.Action("UserDetail", new { id = Model.UserId })" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>Отмена
                        </a>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Дополнительная информация</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Паспортные данные</label>
                        <div class="row">
                            <div class="col-md-6">
                                <input type="text" class="form-control mb-2" name="PassportSeria"
                                       value="@Model.PassportSeria" placeholder="Серия" maxlength="4">
                            </div>
                            <div class="col-md-6">
                                <input type="text" class="form-control mb-2" name="PassportNumber"
                                       value="@Model.PassportNumber" placeholder="Номер" maxlength="6">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Прописка</label>
                        <textarea class="form-control" name="Propiska" rows="2">@Model.Propiska</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Место проживания</label>
                        <textarea class="form-control" name="PlaceLive" rows="2">@Model.PlaceLive</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Валидация формы
                $('form').validate({
            rules: {
                FullName: { required: true, minlength: 2 },
                Email: { required: true, email: true },
                PhoneNumber: { required: true }
                // Убрали проверку для необязательных полей
            },
            messages: {
                FullName: "Введите полное имя",
                Email: "Введите корректный email",
                PhoneNumber: "Введите номер телефона"
            }
        });

            // Ограничение ввода для паспортных данных
            $('input[name="PassportSeria"]').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '').substring(0, 4);
            });

            $('input[name="PassportNumber"]').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '').substring(0, 6);
            });
        });
    </script>
}